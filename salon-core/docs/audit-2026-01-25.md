# Audit: Unimplemented or Incomplete Areas (2026-01-25)

Scope: salon-core + local cal.com integration status for real tests.

## Findings
- No TODO/FIXME/NOT_IMPLEMENTED markers in `src/` (core logic is implemented).
- Health endpoints respond: /health, /health/queues, /health/metrics.
- Cal.com API v2 is reachable and authenticated (GET /v2/atoms/event-types returns 200).

## Implemented blocks (code-level)
- Inbound webhooks: telegram/vkmax/instagram/whatsapp (validation + normalization).
- Cal.com booking create/reschedule/cancel flows (API v2 + payload mapping).
- Queue workers: tx, mk, sender, reminder (retries + dead-letter).
- Channel senders: telegram/vkmax/instagram/whatsapp.
- Idempotency + rate limits + quiet hours + metrics/health endpoints.

## Gaps blocking real tests
- erxes is not configured for real calls (MOCK_ERXES=1; SALON_CORE_API_URL + SALON_CORE_ADMIN_TOKEN not set in erxes).
- Channel providers are not configured for real delivery (MOCK_SENDERS=1; missing provider tokens and webhook secrets).
- Tenant config is incomplete for real tests (brandId, integrationIds, channel tokens, webhook secrets).
- Cal.com webhook is not configured in the Cal.com UI for `/webhooks/calcom/:tenantId?`.
- cal.com API license check is bypassed locally via `IS_E2E=true`; production needs a valid license key and `IS_E2E=false`.

## Issues found + fixed
- Quiet-hours scheduling used server local hours even when a tenant timeZone was provided; now it shifts using timeZone-aware checks.
- /queue/tx and /queue/reminders accepted missing idempotencyKey and returned 409; now return 400 for missing keys.
- /queue/tx and /send accepted empty channel/to/message; now validate required fields and return 400.

## Update 2026-01-26 (erxes/gateway on Windows)
- Fixed salonhelp backend proxy to import fetch explicitly (ts-node CJS on Windows).
- Fixed ESM-only `file-type` usage by switching to dynamic import (avoids ERR_REQUIRE_ESM).
- Gateway Apollo Router now runs via Docker on Windows (container `erxes-apollo-router`, port 50000).
- Added `ENABLED_PLUGINS_UI` to allow UI-only plugins without blocking gateway service discovery.
- core-ui dev server moved to port 3005 (3001 occupied); UI dev script uses `npx nx`.

## Update 2026-01-26 (smoke execution)
- Full smoke run completed in mock/unsigned mode (health, inbound, booking, calcom webhook, queue, send).
- Inbound webhook validated for Telegram/VK/Instagram/WhatsApp with generic payload (strict inbound off).
- DB populated from smoke: `message_log`, `clients`, `appointments_map`, `job_log`.

## Next steps (roadmap link)
See `docs/roadmap-real-tests.md` for the ordered plan and checklist.

## Update 2026-01-26 (platform audit pass + fixes)
- repo_inventory.py timed out on large repos; manual audit used instead.
- Unimplemented markers: none in salon-core `src/`; none in salonhelp backend/UI; only a non-blocking TODO in `erxes-integrations/src/models/utils.ts`.
- salon-core build check passed (`npm run build`).
- salon-core env audit warnings: missing CALCOM_API_BASE/KEY, ERXES_API_BASE, and channel tokens (real tests require secrets).
- Fixed erxes dev scripts to call `node scripts/start-*-dev.js` directly (dotenv CLI error removed).
- Known warnings from erxes logs: duplicate Mongoose indexes + AWS SDK v2 maintenance notice (non-blocking).
